{"ast":null,"code":"import _classCallCheck from\"/Users/yanghaochen/Desktop/CS185/CS185_hw8/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/yanghaochen/Desktop/CS185/CS185_hw8/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/yanghaochen/Desktop/CS185/CS185_hw8/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/yanghaochen/Desktop/CS185/CS185_hw8/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import config from'../config.js';var firebase=require('firebase');var d3=require('d3');var data={nodes:[],links:[]};var connectedActors=[];var actorIndex=[];export var Graph=/*#__PURE__*/function(_Component){_inherits(Graph,_Component);var _super=_createSuper(Graph);function Graph(props){var _this;_classCallCheck(this,Graph);_this=_super.call(this);_this.drag=function(simulation,tooltip,headerHeight,navHeight){function dragStarted(d){if(!d3.event.active){simulation.alphaTarget(0.3).restart();}d.fx=d.x;d.fy=d.y;}function dragged(d){d.fx=d3.event.x;d.fy=d3.event.y;tooltip.style('top',d.fy+headerHeight+navHeight-20+'px').style('left',d.fx+20+'px');}function dragEnded(d){if(!d3.event.active){simulation.alphaTarget(0);}d.fx=null;d.fy=null;}return d3.drag().on('start',dragStarted).on('drag',dragged).on('end',dragEnded);};_this.state={movieInfo:{}};return _this;}_createClass(Graph,[{key:\"chart\",value:function chart(nodes,links){var width=1920;var height=800;var obj_links=links.map(function(d){return Object.create(d);});var obj_nodes=nodes.map(function(d){return Object.create(d);});var svg=d3.create('svg').attr('viewBox',[0,0,width,height]);var link=svg.append('g').attr('stroke','#999').attr('stroke-opacity',0.6).selectAll('line').data(obj_links).join('line').attr('stroke-width',function(d){return Math.sqrt(d.value);});var simulation=d3.forceSimulation(obj_nodes).force('link',d3.forceLink().links(obj_links).id(function(d){return d.name;}).distance(200)).force('charge',d3.forceManyBody()).force('center',d3.forceCenter(width/2,height/2));var tooltip=d3.select('body').append('div').style('position','absolute').style('z-index','10').style('visibility','hidden');var hf=function hf(node){if(node.type==='movie'){return node.src;}return'';};svg.append('defs').selectAll('pattern').data(obj_nodes).enter().append(\"pattern\").attr('id',function(d){return'id-'+d.id;}).attr('patternUnits','objectBoundingBox').attr('width',1).attr('height',1).append('image').attr('xlink:href',hf).attr('x',-35).attr('y',-35).attr('width',220).attr('height',220);var color=function color(node){if(node.type==='movie'){return\"url(#id-\"+node.id+\")\";}return d3.color('gray');};var radius=function radius(node){if(node.type==='actor'){return 30;}return 75;};var node=svg.append('g').attr('stroke','#000').attr('stroke-opacity',1.5).selectAll('circle').data(obj_nodes).join('circle').attr('r',radius).style('fill',color).attr('cursor','pointer');var headerHeight=document.getElementsByClassName('header')[0].offsetHeight;var navHeight=document.getElementsByClassName('nav-bar')[0].offsetHeight;node.on('mouseover',function(node){if(node.type==='actor'){tooltip.text(node.name);tooltip.style('visibility','visible');tooltip.style('top',d3.event.y-30+'px').style('left',d3.event.x+15+'px');}}).on('mouseout',function(){return tooltip.style('visibility','hidden');}).call(this.drag(simulation,tooltip,headerHeight,navHeight));simulation.on('tick',function(){link.attr('x1',function(d){return d.source.x;}).attr('y1',function(d){return d.source.y;}).attr('x2',function(d){return d.target.x;}).attr('y2',function(d){return d.target.y;});node.attr('cx',function(d){return d.x;}).attr('cy',function(d){return d.y;});});return svg.node();}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;document.title='Graph';if(!firebase.apps.length){firebase.initializeApp(config);}var movsInGraph=[];var ref=firebase.database().ref('relations');ref.once('value').then(function(snapshot){var rels=snapshot.val();for(var entry in rels){if(rels[entry].list==='GraphViz'){movsInGraph.push(rels[entry].mov);}}});var movieInfo=[];var movsRef=firebase.database().ref('movies');movsRef.once('value').then(function(snapshot){var movies=snapshot.val();for(var entry in movies){if(movsInGraph.includes(entry)){movieInfo.push({name:movies[entry].name,src:movies[entry].src,actors:movies[entry].actors,id:entry});console.log(\"already push actors: \",movies[entry].actors);}}var index=0;for(var i in movieInfo){var movieObj={type:'movie',name:movieInfo[i].name,src:movieInfo[i].src,id:index};index++;data.nodes.push(movieObj);//    console.log(\"movie actors are :\", movieInfo[i].actors);\nvar actors=movieInfo[i].actors.split(', ');for(var j in actors){var actObj={type:'actor',name:actors[j],id:index};index++;if(!connectedActors.includes(actors[j])){connectedActors.push(actors[j]);data.nodes.push(actObj);var loc=data.nodes.indexOf(actObj);actorIndex.push(loc);}var linkObj={source:movieInfo[i].name,target:actors[j],live:1};data.links.push(linkObj);}}var elem=document.getElementById('mysvg');elem.appendChild(_this2.chart(data.nodes,data.links));});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){data.nodes=[];data.links=[];connectedActors=[];actorIndex=[];}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{id:\"mysvg\"});}}]);return Graph;}(Component);export default Graph;","map":{"version":3,"sources":["/Users/yanghaochen/Desktop/CS185/CS185_hw8/src/Components/Graph.js"],"names":["React","Component","config","firebase","require","d3","data","nodes","links","connectedActors","actorIndex","Graph","props","drag","simulation","tooltip","headerHeight","navHeight","dragStarted","d","event","active","alphaTarget","restart","fx","x","fy","y","dragged","style","dragEnded","on","state","movieInfo","width","height","obj_links","map","Object","create","obj_nodes","svg","attr","link","append","selectAll","join","Math","sqrt","value","forceSimulation","force","forceLink","id","name","distance","forceManyBody","forceCenter","select","hf","node","type","src","enter","color","radius","document","getElementsByClassName","offsetHeight","text","call","source","target","title","apps","length","initializeApp","movsInGraph","ref","database","once","then","snapshot","rels","val","entry","list","push","mov","movsRef","movies","includes","actors","console","log","index","i","movieObj","split","j","actObj","loc","indexOf","linkObj","live","elem","getElementById","appendChild","chart"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport config from '../config.js';\nconst firebase = require('firebase')\nvar d3 = require('d3');\n\nlet data = {\n  nodes: [],\n  links: [],\n}\n\nlet connectedActors = [];\nlet actorIndex = [];\n\nexport class Graph extends Component {\n  constructor(props) {\n    super();\n    this.state = {\n      movieInfo: {},\n    }\n  }\n\n  drag = (simulation, tooltip, headerHeight, navHeight) => {\n    function dragStarted(d) {\n      if(!d3.event.active) {\n        simulation.alphaTarget(0.3).restart();\n      }\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged(d) {\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n      tooltip.style('top', (d.fy + headerHeight + navHeight - 20) + 'px').style('left',(d.fx + 20) + 'px');\n    }\n\n    function dragEnded(d) {\n      if(!d3.event.active) {\n        simulation.alphaTarget(0);\n      }\n      d.fx = null;\n      d.fy = null;\n    }\n\n    return d3.drag()\n      .on('start', dragStarted)\n      .on('drag', dragged)\n      .on('end', dragEnded);\n  }\n\n  chart(nodes, links) {\n    const width = 1920\n    const height = 800\n\n    const obj_links = links.map(d => Object.create(d));\n    const obj_nodes = nodes.map(d => Object.create(d));\n\n    const svg = d3.create('svg').attr('viewBox', [0, 0, width, height]);\n\n    const link = svg.append('g')\n      .attr('stroke', '#999')\n      .attr('stroke-opacity', 0.6)\n      .selectAll('line')\n      .data(obj_links)\n      .join('line')\n      .attr('stroke-width', d => Math.sqrt(d.value));\n\n    const simulation = d3.forceSimulation(obj_nodes)\n      .force('link', d3.forceLink().links(obj_links).id(d => { return d.name; }).distance(200))\n      .force('charge', d3.forceManyBody())\n      .force('center', d3.forceCenter(width/2, height/2));\n\n    let tooltip = d3.select('body')\n      .append('div')\n      .style('position', 'absolute')\n      .style('z-index', '10')\n      .style('visibility', 'hidden')\n\n     const hf = (node) => {\n      if(node.type === 'movie') {\n        return node.src;\n      }\n     \n      return '';\n     }\n\n    svg.append('defs')\n      .selectAll('pattern')\n      .data(obj_nodes)\n      .enter()\n      .append(\"pattern\")\n      .attr('id', function(d) {\n        return 'id-'+d.id;\n      })\n      .attr('patternUnits', 'objectBoundingBox')\n      .attr('width', 1)\n      .attr('height', 1)\n      .append('image')\n      .attr('xlink:href', hf)\n      .attr('x', -35)\n      .attr('y', -35)\n      .attr('width', 220)\n      .attr('height', 220);\n     \n    const color = (node) =>{\n          if(node.type === 'movie') {\n               return (\"url(#id-\"+node.id+\")\");\n          }\n          return d3.color('gray');\n    }\n\n    const radius = (node) => {\n     if(node.type === 'actor') {\n       return 30;\n     } \n     return 75;\n   }\n      \n    const node = svg.append('g')\n      .attr('stroke', '#000')\n      .attr('stroke-opacity', 1.5)\n      .selectAll('circle')\n      .data(obj_nodes)\n      .join('circle')\n      .attr('r', radius)\n      .style('fill', color)\n      .attr('cursor', 'pointer')\n\n     const headerHeight = document.getElementsByClassName('header')[0].offsetHeight;\n     const navHeight = document.getElementsByClassName('nav-bar')[0].offsetHeight;\n     node.on('mouseover', function(node){\n        if(node.type === 'actor') {\n          tooltip.text(node.name);\n          tooltip.style('visibility', 'visible');\n          tooltip.style('top', (d3.event.y-30)+'px').style('left',(d3.event.x+15)+'px');\n        }\n      })\n\t    .on('mouseout', function(){\n        return tooltip.style('visibility', 'hidden');\n      })\n      .call(this.drag(simulation, tooltip, headerHeight, navHeight));\n\n    simulation.on('tick', () => {\n      link\n          .attr('x1', d => d.source.x)\n          .attr('y1', d => d.source.y)\n          .attr('x2', d => d.target.x)\n          .attr('y2', d => d.target.y);\n\n      node\n          .attr('cx', d => d.x)\n          .attr('cy', d => d.y);\n    });\n\n    return svg.node();\n  }\n\n  componentDidMount(){\n    document.title = 'Graph';\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n\n    let movsInGraph = [];\n    let ref = firebase.database().ref('relations');\n    ref.once('value').then(snapshot => {\n      let rels = snapshot.val();\n      for (let entry in rels) {\n        if(rels[entry].list === 'GraphViz') {\n          movsInGraph.push(rels[entry].mov);\n        }\n      }\n    });\n\n    let movieInfo = [];\n    let movsRef = firebase.database().ref('movies');\n    movsRef.once('value').then(snapshot => {\n      let movies = snapshot.val();\n      for (let entry in movies) {\n        if (movsInGraph.includes(entry)) {\n          movieInfo.push({\n            name:  movies[entry].name,\n            src:  movies[entry].src,\n            actors: movies[entry].actors,\n            id:  entry,\n          })\n          console.log(\"already push actors: \", movies[entry].actors);\n        }\n      }\n\n     let index = 0;\n     for(let i in movieInfo) {\n        let movieObj = {\n          type: 'movie',\n          name: movieInfo[i].name,\n          src: movieInfo[i].src,\n          id: index,\n        }\n        index++;\n        data.nodes.push(movieObj);\n     \n     //    console.log(\"movie actors are :\", movieInfo[i].actors);\n        let actors = movieInfo[i].actors.split(', ');\n        for(let j in actors) {\n          let actObj = {\n            type: 'actor',\n            name: actors[j],\n            id: index,\n          }\n          index++;\n\n          if(!(connectedActors.includes(actors[j]))) {\n            connectedActors.push(actors[j]);\n            data.nodes.push(actObj);\n            let loc = data.nodes.indexOf(actObj);\n            actorIndex.push(loc);\n          }\n          \n          let linkObj = {\n            source: movieInfo[i].name,\n            target: actors[j],\n            live: 1,\n          }\n          data.links.push(linkObj);\n        }\n      }\n\n      const elem = document.getElementById('mysvg');\n      elem.appendChild(this.chart(data.nodes, data.links));\n    });\n  }\n\n  componentWillUnmount() {\n    data.nodes = [];\n    data.links = [];\n    connectedActors = [];\n    actorIndex = [];\n  }\n\n  render() {\n    return <div id='mysvg'>\n      </div>      \n  }\n}\nexport default Graph;"]},"metadata":{},"sourceType":"module"}