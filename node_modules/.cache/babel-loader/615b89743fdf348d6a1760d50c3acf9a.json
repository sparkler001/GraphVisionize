{"ast":null,"code":"var _jsxFileName = \"/Users/yanghaochen/Desktop/CS185/CS185_hw8/src/Components/Graph.js\";\nimport React, { Component } from 'react';\nimport config from '../config.js';\n\nconst firebase = require('firebase');\n\nvar d3 = require('d3');\n\nlet data = {\n  nodes: [],\n  links: []\n};\nlet connectedActors = [];\nlet actorIndex = [];\nexport class Graph extends Component {\n  constructor() {\n    super();\n\n    this.drag = (simulation, tooltip, headerHeight, navHeight) => {\n      function dragStarted(d) {\n        if (!d3.event.active) {\n          simulation.alphaTarget(0.3).restart();\n        }\n\n        d.fx = d.x;\n        d.fy = d.y;\n      }\n\n      function dragged(d) {\n        d.fx = d3.event.x;\n        d.fy = d3.event.y;\n        tooltip.style('top', d.fy + headerHeight + navHeight - 20 + 'px').style('left', d.fx + 20 + 'px');\n      }\n\n      function dragEnded(d) {\n        if (!d3.event.active) {\n          simulation.alphaTarget(0);\n        }\n\n        d.fx = null;\n        d.fy = null;\n      }\n\n      return d3.drag().on('start', dragStarted).on('drag', dragged).on('end', dragEnded);\n    };\n\n    this.state = {\n      movieInfo: {}\n    };\n  }\n\n  chart(nodes, links) {\n    const width = 1920;\n    const height = 800;\n    const obj_links = links.map(d => Object.create(d));\n    const obj_nodes = nodes.map(d => Object.create(d));\n    const svg = d3.create('svg').attr('viewBox', [0, 0, width, height]);\n    const link = svg.append('g').attr('stroke', '#999').attr('stroke-opacity', 0.6).selectAll('line').data(obj_links).join('line').attr('stroke-width', d => Math.sqrt(d.value));\n    const simulation = d3.forceSimulation(obj_nodes).force('link', d3.forceLink().links(obj_links).id(d => {\n      return d.name;\n    }).distance(200)).force('charge', d3.forceManyBody()).force('center', d3.forceCenter(width / 2, height / 2));\n    let tooltip = d3.select('body').append('div').style('position', 'absolute').style('z-index', '10').style('visibility', 'hidden');\n\n    const hf = node => {\n      if (node.type === 'movie') {\n        return node.src;\n      }\n\n      return '';\n    };\n\n    svg.append('defs').selectAll('pattern').data(obj_nodes).enter().append(\"pattern\").attr('id', function (d) {\n      return 'id-' + d.id;\n    }).attr('patternUnits', 'objectBoundingBox').attr('width', 1).attr('height', 1).append('image').attr('xlink:href', hf).attr('x', -35).attr('y', -35).attr('width', 220).attr('height', 220);\n\n    const color = node => {\n      if (node.type === 'movie') {\n        return \"url(#id-\" + node.id + \")\";\n      }\n\n      return d3.color('gray');\n    };\n\n    const radius = node => {\n      if (node.type === 'actor') {\n        return 30;\n      }\n\n      return 75;\n    };\n\n    const node = svg.append('g').attr('stroke', '#000').attr('stroke-opacity', 1.5).selectAll('circle').data(obj_nodes).join('circle').attr('r', radius).style('fill', color).attr('cursor', 'pointer');\n    const headerHeight = document.getElementsByClassName('header')[0].offsetHeight;\n    const navHeight = document.getElementsByClassName('nav-bar')[0].offsetHeight;\n    node.on('mouseover', function (node) {\n      if (node.type === 'actor') {\n        tooltip.text(node.name);\n        tooltip.style('visibility', 'visible');\n        tooltip.style('top', d3.event.y - 30 + 'px').style('left', d3.event.x + 15 + 'px');\n      }\n    }).on('mouseout', function () {\n      return tooltip.style('visibility', 'hidden');\n    }).call(this.drag(simulation, tooltip, headerHeight, navHeight));\n    simulation.on('tick', () => {\n      link.attr('x1', d => d.source.x).attr('y1', d => d.source.y).attr('x2', d => d.target.x).attr('y2', d => d.target.y);\n      node.attr('cx', d => d.x).attr('cy', d => d.y);\n    });\n    return svg.node();\n  }\n\n  componentDidMount() {\n    document.title = 'Graph';\n\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n\n    let movsInGraph = [];\n    let ref = firebase.database().ref('relations');\n    ref.once('value').then(snapshot => {\n      let rels = snapshot.val();\n\n      for (let entry in rels) {\n        if (rels[entry].list === 'GraphViz') {\n          movsInGraph.push(rels[entry].mov);\n        }\n      }\n    });\n    let movieInfo = [];\n    let movsRef = firebase.database().ref('movies');\n    movsRef.once('value').then(snapshot => {\n      let movies = snapshot.val();\n\n      for (let entry in movies) {\n        if (movsInGraph.includes(entry)) {\n          movieInfo.push({\n            name: movies[entry].name,\n            src: movies[entry].src,\n            actors: movies[entry].actors,\n            id: entry\n          });\n          console.log(\"already push actors: \", movies[entry].actors);\n        }\n      }\n\n      let index = 0;\n\n      for (let i in movieInfo) {\n        let movieObj = {\n          type: 'movie',\n          name: movieInfo[i].name,\n          src: movieInfo[i].src,\n          id: index\n        };\n        index++;\n        data.nodes.push(movieObj); //    console.log(\"movie actors are :\", movieInfo[i].actors);\n\n        let actors = movieInfo[i].actors.split(', ');\n\n        for (let j in actors) {\n          let actObj = {\n            type: 'actor',\n            name: actors[j],\n            id: index\n          };\n          index++;\n\n          if (!connectedActors.includes(actors[j])) {\n            connectedActors.push(actors[j]);\n            data.nodes.push(actObj);\n            let loc = data.nodes.indexOf(actObj);\n            actorIndex.push(loc);\n          }\n\n          let linkObj = {\n            source: movieInfo[i].name,\n            target: actors[j],\n            live: 1\n          };\n          data.links.push(linkObj);\n        }\n      }\n\n      const elem = document.getElementById('mysvg');\n      elem.appendChild(this.chart(data.nodes, data.links));\n    });\n  }\n\n  componentWillUnmount() {\n    data.nodes = [];\n    data.links = [];\n    connectedActors = [];\n    actorIndex = [];\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"mysvg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 12\n      }\n    });\n  }\n\n}\nexport default Graph;","map":{"version":3,"sources":["/Users/yanghaochen/Desktop/CS185/CS185_hw8/src/Components/Graph.js"],"names":["React","Component","config","firebase","require","d3","data","nodes","links","connectedActors","actorIndex","Graph","constructor","drag","simulation","tooltip","headerHeight","navHeight","dragStarted","d","event","active","alphaTarget","restart","fx","x","fy","y","dragged","style","dragEnded","on","state","movieInfo","chart","width","height","obj_links","map","Object","create","obj_nodes","svg","attr","link","append","selectAll","join","Math","sqrt","value","forceSimulation","force","forceLink","id","name","distance","forceManyBody","forceCenter","select","hf","node","type","src","enter","color","radius","document","getElementsByClassName","offsetHeight","text","call","source","target","componentDidMount","title","apps","length","initializeApp","movsInGraph","ref","database","once","then","snapshot","rels","val","entry","list","push","mov","movsRef","movies","includes","actors","console","log","index","i","movieObj","split","j","actObj","loc","indexOf","linkObj","live","elem","getElementById","appendChild","componentWillUnmount","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport config from '../config.js';\nconst firebase = require('firebase')\nvar d3 = require('d3');\n\nlet data = {\n  nodes: [],\n  links: [],\n}\n\nlet connectedActors = [];\nlet actorIndex = [];\n\nexport class Graph extends Component {\n  constructor() {\n    super();\n    this.state = {\n      movieInfo: {},\n    }\n  }\n\n  drag = (simulation, tooltip, headerHeight, navHeight) => {\n    function dragStarted(d) {\n      if(!d3.event.active) {\n        simulation.alphaTarget(0.3).restart();\n      }\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged(d) {\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n      tooltip.style('top', (d.fy + headerHeight + navHeight - 20) + 'px').style('left',(d.fx + 20) + 'px');\n    }\n\n    function dragEnded(d) {\n      if(!d3.event.active) {\n        simulation.alphaTarget(0);\n      }\n      d.fx = null;\n      d.fy = null;\n    }\n\n    return d3.drag()\n      .on('start', dragStarted)\n      .on('drag', dragged)\n      .on('end', dragEnded);\n  }\n\n  chart(nodes, links) {\n    const width = 1920\n    const height = 800\n\n    const obj_links = links.map(d => Object.create(d));\n    const obj_nodes = nodes.map(d => Object.create(d));\n\n    const svg = d3.create('svg').attr('viewBox', [0, 0, width, height]);\n\n    const link = svg.append('g')\n      .attr('stroke', '#999')\n      .attr('stroke-opacity', 0.6)\n      .selectAll('line')\n      .data(obj_links)\n      .join('line')\n      .attr('stroke-width', d => Math.sqrt(d.value));\n\n    const simulation = d3.forceSimulation(obj_nodes)\n      .force('link', d3.forceLink().links(obj_links).id(d => { return d.name; }).distance(200))\n      .force('charge', d3.forceManyBody())\n      .force('center', d3.forceCenter(width/2, height/2));\n\n    let tooltip = d3.select('body')\n      .append('div')\n      .style('position', 'absolute')\n      .style('z-index', '10')\n      .style('visibility', 'hidden')\n\n     const hf = (node) => {\n      if(node.type === 'movie') {\n        return node.src;\n      }\n     \n      return '';\n     }\n\n    svg.append('defs')\n      .selectAll('pattern')\n      .data(obj_nodes)\n      .enter()\n      .append(\"pattern\")\n      .attr('id', function(d) {\n        return 'id-'+d.id;\n      })\n      .attr('patternUnits', 'objectBoundingBox')\n      .attr('width', 1)\n      .attr('height', 1)\n      .append('image')\n      .attr('xlink:href', hf)\n      .attr('x', -35)\n      .attr('y', -35)\n      .attr('width', 220)\n      .attr('height', 220);\n     \n    const color = (node) =>{\n          if(node.type === 'movie') {\n               return (\"url(#id-\"+node.id+\")\");\n          }\n          return d3.color('gray');\n    }\n\n    const radius = (node) => {\n     if(node.type === 'actor') {\n       return 30;\n     } \n     return 75;\n   }\n      \n    const node = svg.append('g')\n      .attr('stroke', '#000')\n      .attr('stroke-opacity', 1.5)\n      .selectAll('circle')\n      .data(obj_nodes)\n      .join('circle')\n      .attr('r', radius)\n      .style('fill', color)\n      .attr('cursor', 'pointer')\n\n     const headerHeight = document.getElementsByClassName('header')[0].offsetHeight;\n     const navHeight = document.getElementsByClassName('nav-bar')[0].offsetHeight;\n     node.on('mouseover', function(node){\n        if(node.type === 'actor') {\n          tooltip.text(node.name);\n          tooltip.style('visibility', 'visible');\n          tooltip.style('top', (d3.event.y-30)+'px').style('left',(d3.event.x+15)+'px');\n        }\n      })\n\t    .on('mouseout', function(){\n        return tooltip.style('visibility', 'hidden');\n      })\n      .call(this.drag(simulation, tooltip, headerHeight, navHeight));\n\n    simulation.on('tick', () => {\n      link\n          .attr('x1', d => d.source.x)\n          .attr('y1', d => d.source.y)\n          .attr('x2', d => d.target.x)\n          .attr('y2', d => d.target.y);\n\n      node\n          .attr('cx', d => d.x)\n          .attr('cy', d => d.y);\n    });\n\n    return svg.node();\n  }\n\n  componentDidMount(){\n    document.title = 'Graph';\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n\n    let movsInGraph = [];\n    let ref = firebase.database().ref('relations');\n    ref.once('value').then(snapshot => {\n      let rels = snapshot.val();\n      for (let entry in rels) {\n        if(rels[entry].list === 'GraphViz') {\n          movsInGraph.push(rels[entry].mov);\n        }\n      }\n    });\n\n    let movieInfo = [];\n    let movsRef = firebase.database().ref('movies');\n    movsRef.once('value').then(snapshot => {\n      let movies = snapshot.val();\n      for (let entry in movies) {\n        if (movsInGraph.includes(entry)) {\n          movieInfo.push({\n            name:  movies[entry].name,\n            src:  movies[entry].src,\n            actors: movies[entry].actors,\n            id:  entry,\n          })\n          console.log(\"already push actors: \", movies[entry].actors);\n        }\n      }\n\n     let index = 0;\n     for(let i in movieInfo) {\n        let movieObj = {\n          type: 'movie',\n          name: movieInfo[i].name,\n          src: movieInfo[i].src,\n          id: index,\n        }\n        index++;\n        data.nodes.push(movieObj);\n     \n     //    console.log(\"movie actors are :\", movieInfo[i].actors);\n        let actors = movieInfo[i].actors.split(', ');\n        for(let j in actors) {\n          let actObj = {\n            type: 'actor',\n            name: actors[j],\n            id: index,\n          }\n          index++;\n\n          if(!(connectedActors.includes(actors[j]))) {\n            connectedActors.push(actors[j]);\n            data.nodes.push(actObj);\n            let loc = data.nodes.indexOf(actObj);\n            actorIndex.push(loc);\n          }\n          \n          let linkObj = {\n            source: movieInfo[i].name,\n            target: actors[j],\n            live: 1,\n          }\n          data.links.push(linkObj);\n        }\n      }\n\n      const elem = document.getElementById('mysvg');\n      elem.appendChild(this.chart(data.nodes, data.links));\n    });\n  }\n\n  componentWillUnmount() {\n    data.nodes = [];\n    data.links = [];\n    connectedActors = [];\n    actorIndex = [];\n  }\n\n  render() {\n    return <div id='mysvg'>\n      </div>      \n  }\n}\nexport default Graph;"]},"metadata":{},"sourceType":"module"}