{"ast":null,"code":"var _jsxFileName = \"/Users/yanghaochen/Desktop/CS185/CS185_hw8/src/Components/Graph.js\";\nimport React, { Component } from 'react';\nimport config from '../config.js';\n\nconst firebase = require('firebase');\n\nvar d3 = require('d3');\n\nlet data = {\n  nodes: [],\n  links: []\n};\nlet encounteredActors = [];\nlet actorPos = [];\nexport class Graph extends Component {\n  constructor(props) {\n    super();\n\n    this.drag = (simulation, tooltip, headerHt, navHt) => {\n      function dragStarted(d) {\n        if (!d3.event.active) {\n          simulation.alphaTarget(0.3).restart();\n        }\n\n        d.fx = d.x;\n        d.fy = d.y;\n      }\n\n      function dragged(d) {\n        d.fx = d3.event.x;\n        d.fy = d3.event.y;\n        tooltip.style('top', d.fy + headerHt + navHt - 20 + 'px').style('left', d.fx + 30 + 'px');\n      }\n\n      function dragEnded(d) {\n        if (!d3.event.active) {\n          simulation.alphaTarget(0);\n        }\n\n        d.fx = null;\n        d.fy = null;\n      }\n\n      return d3.drag().on('start', dragStarted).on('drag', dragged).on('end', dragEnded);\n    };\n\n    this.state = {\n      movInfo: {}\n    };\n  }\n\n  chart(nodes, links) {\n    const width = 1920;\n    const height = 800;\n    const obj_links = links.map(d => Object.create(d));\n    const obj_nodes = nodes.map(d => Object.create(d));\n    const svg = d3.create('svg').attr('viewBox', [0, 0, width, height]);\n    const link = svg.append('g').attr('stroke', '#999').attr('stroke-opacity', 0.6).selectAll('line').data(obj_links).join('line').attr('stroke-width', 1);\n\n    const radius = node => {\n      if (node.type === 'actor') {\n        return 25;\n      }\n\n      return 75;\n    };\n\n    const bg = node => {\n      if (node.type === 'movie') {\n        return node.src;\n      }\n\n      return '';\n    };\n\n    const simulation = d3.forceSimulation(obj_nodes).force('link', d3.forceLink().links(obj_links).id(d => {\n      return d.name;\n    }).distance(200)).force('charge', d3.forceManyBody()).force('center', d3.forceCenter(width / 2, height / 2));\n    let tooltip = d3.select('body').append('div').style('position', 'absolute').style('z-index', '10').style('visibility', 'hidden');\n    svg.append('defs').selectAll('pattern').data(obj_nodes).enter().append(\"pattern\").attr('id', function (d) {\n      return 'id-' + d.id;\n    }).attr('patternUnits', 'objectBoundingBox').attr('width', 1).attr('height', 1).append('image').attr('xlink:href', bg).attr('x', -35).attr('y', -35).attr('width', 220).attr('height', 220);\n    const node = svg.append('g').attr('stroke', '#000').attr('stroke-opacity', 1.5).selectAll('circle').data(obj_nodes).join('circle').attr('r', radius).attr('cursor', 'pointer').style('fill', function (d) {\n      if (d.type === 'movie') {\n        return \"url(#id-\" + d.id + \")\";\n      }\n\n      return d3.color('gray');\n    });\n    const headerHt = document.getElementsByClassName('header')[0].offsetHeight;\n    const navHt = document.getElementsByClassName('nav-bar')[0].offsetHeight;\n    node.on('mouseover', function (node) {\n      if (node.type === 'actor') {\n        tooltip.text(node.name);\n        tooltip.style('visibility', 'visible');\n        tooltip.style('top', d3.event.y - 20 + 'px').style('left', d3.event.x + 20 + 'px');\n      }\n    }).on('mouseout', function () {\n      return tooltip.style('visibility', 'hidden');\n    }).call(this.drag(simulation, tooltip, headerHt, navHt));\n    simulation.on('tick', () => {\n      link.attr('x1', d => d.source.x).attr('y1', d => d.source.y).attr('x2', d => d.target.x).attr('y2', d => d.target.y);\n      node.attr('cx', d => d.x).attr('cy', d => d.y);\n    });\n    return svg.node();\n  }\n\n  componentDidMount() {\n    document.title = 'Graph Visualization';\n\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n\n    let movsInGraph = [];\n    let ref = firebase.database().ref('relations');\n    ref.once('value').then(snapshot => {\n      let rels = snapshot.val();\n\n      for (let entry in rels) {\n        if (rels[entry].list === 'GraphViz') {\n          movsInGraph.push(rels[entry].mov);\n        }\n      }\n    });\n    let movInfo = [];\n    let movsRef = firebase.database().ref('movies');\n    movsRef.once('value').then(snapshot => {\n      let movies = snapshot.val();\n\n      for (let entry in movies) {\n        if (movsInGraph.includes(entry)) {\n          movInfo.push({\n            id: entry,\n            name: movies[entry].name,\n            src: movies[entry].src,\n            actors: movies[entry].actors\n          });\n          console.log(\"already push actors: \", movies[entry].actors);\n        }\n      }\n\n      let ctr = 0;\n\n      for (let i in movInfo) {\n        let movieObj = {\n          type: 'movie',\n          name: movInfo[i].name,\n          src: movInfo[i].src,\n          id: ctr\n        };\n        ctr++;\n        data.nodes.push(movieObj); //    console.log(\"movie actors are :\", movInfo[i].actors);\n\n        let actors = movInfo[i].actors.split(', ');\n\n        for (let j in actors) {\n          let actObj = {\n            type: 'actor',\n            name: actors[j],\n            id: ctr\n          };\n          ctr++;\n\n          if (!encounteredActors.includes(actors[j])) {\n            encounteredActors.push(actors[j]);\n            data.nodes.push(actObj);\n            let loc = data.nodes.indexOf(actObj);\n            actorPos.push(loc);\n          }\n\n          let linkObj = {\n            source: movInfo[i].name,\n            target: actors[j]\n          };\n          data.links.push(linkObj);\n        }\n      }\n\n      const elem = document.getElementById('mysvg');\n      elem.appendChild(this.chart(data.nodes, data.links));\n    });\n  }\n\n  componentWillUnmount() {\n    data.nodes = [];\n    data.links = [];\n    encounteredActors = [];\n    actorPos = [];\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"mysvg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 12\n      }\n    });\n  }\n\n}\nexport default Graph;","map":{"version":3,"sources":["/Users/yanghaochen/Desktop/CS185/CS185_hw8/src/Components/Graph.js"],"names":["React","Component","config","firebase","require","d3","data","nodes","links","encounteredActors","actorPos","Graph","constructor","props","drag","simulation","tooltip","headerHt","navHt","dragStarted","d","event","active","alphaTarget","restart","fx","x","fy","y","dragged","style","dragEnded","on","state","movInfo","chart","width","height","obj_links","map","Object","create","obj_nodes","svg","attr","link","append","selectAll","join","radius","node","type","bg","src","forceSimulation","force","forceLink","id","name","distance","forceManyBody","forceCenter","select","enter","color","document","getElementsByClassName","offsetHeight","text","call","source","target","componentDidMount","title","apps","length","initializeApp","movsInGraph","ref","database","once","then","snapshot","rels","val","entry","list","push","mov","movsRef","movies","includes","actors","console","log","ctr","i","movieObj","split","j","actObj","loc","indexOf","linkObj","elem","getElementById","appendChild","componentWillUnmount","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport config from '../config.js';\nconst firebase = require('firebase')\nvar d3 = require('d3');\n\nlet data = {\n  nodes: [],\n  links: [],\n}\n\nlet encounteredActors = [];\nlet actorPos = [];\n\nexport class Graph extends Component {\n  constructor(props) {\n    super();\n    this.state = {\n      movInfo: {},\n    }\n  }\n\n  drag = (simulation, tooltip, headerHt, navHt) => {\n    function dragStarted(d) {\n      if(!d3.event.active) {\n        simulation.alphaTarget(0.3).restart();\n      }\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged(d) {\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n      tooltip.style('top', (d.fy+headerHt+navHt-20)+'px').style('left',(d.fx+30)+'px');\n    }\n\n    function dragEnded(d) {\n      if(!d3.event.active) {\n        simulation.alphaTarget(0);\n      }\n      d.fx = null;\n      d.fy = null;\n    }\n\n    return d3.drag()\n      .on('start', dragStarted)\n      .on('drag', dragged)\n      .on('end', dragEnded);\n  }\n\n  chart(nodes, links) {\n    const width = 1920\n    const height = 800\n\n    const obj_links = links.map(d => Object.create(d));\n    const obj_nodes = nodes.map(d => Object.create(d));\n\n    const svg = d3.create('svg').attr('viewBox', [0, 0, width, height]);\n\n    const link = svg.append('g')\n      .attr('stroke', '#999')\n      .attr('stroke-opacity', 0.6)\n      .selectAll('line')\n      .data(obj_links)\n      .join('line')\n      .attr('stroke-width', 1);\n\n    const radius = (node) => {\n      if(node.type === 'actor') {\n        return 25;\n      } \n      return 75;\n    }\n\n    const bg = (node) => {\n      if(node.type === 'movie') {\n        return node.src;\n      }\n      return '';\n    }\n\n    const simulation = d3.forceSimulation(obj_nodes)\n      .force('link', d3.forceLink().links(obj_links).id(d => { return d.name; }).distance(200))\n      .force('charge', d3.forceManyBody())\n      .force('center', d3.forceCenter(width/2, height/2));\n\n    let tooltip = d3.select('body')\n      .append('div')\n      .style('position', 'absolute')\n      .style('z-index', '10')\n      .style('visibility', 'hidden')\n\n    svg.append('defs')\n      .selectAll('pattern')\n      .data(obj_nodes)\n      .enter()\n      .append(\"pattern\")\n      .attr('id', function(d) {\n        return 'id-'+d.id;\n      })\n      .attr('patternUnits', 'objectBoundingBox')\n      .attr('width', 1)\n      .attr('height', 1)\n      .append('image')\n      .attr('xlink:href', bg)\n      .attr('x', -35)\n      .attr('y', -35)\n      .attr('width', 220)\n      .attr('height', 220);\n\n    const node = svg.append('g')\n      .attr('stroke', '#000')\n      .attr('stroke-opacity', 1.5)\n      .selectAll('circle')\n      .data(obj_nodes)\n      .join('circle')\n      .attr('r', radius)\n      .attr('cursor', 'pointer')\n      .style('fill', function(d) { \n        if(d.type === 'movie') {\n          return (\"url(#id-\"+d.id+\")\");\n        }\n        return d3.color('gray');\n      })\n\n     const headerHt = document.getElementsByClassName('header')[0].offsetHeight;\n     const navHt = document.getElementsByClassName('nav-bar')[0].offsetHeight;\n     node.on('mouseover', function(node){\n        if(node.type === 'actor') {\n          tooltip.text(node.name);\n          tooltip.style('visibility', 'visible');\n          tooltip.style('top', (d3.event.y-20)+'px').style('left',(d3.event.x+20)+'px');\n        }\n      })\n\t    .on('mouseout', function(){\n        return tooltip.style('visibility', 'hidden');\n      })\n      .call(this.drag(simulation, tooltip, headerHt, navHt));\n\n    simulation.on('tick', () => {\n      link.attr('x1', d => d.source.x)\n        .attr('y1', d => d.source.y)\n        .attr('x2', d => d.target.x)\n        .attr('y2', d => d.target.y);\n\n      node.attr('cx', d => d.x)\n        .attr('cy', d => d.y);\n    });\n\n    return svg.node();\n  }\n\n  componentDidMount(){\n    document.title = 'Graph Visualization';\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n\n    let movsInGraph = [];\n    let ref = firebase.database().ref('relations');\n    ref.once('value').then(snapshot => {\n      let rels = snapshot.val();\n      for (let entry in rels) {\n        if(rels[entry].list === 'GraphViz') {\n          movsInGraph.push(rels[entry].mov);\n        }\n      }\n    });\n\n    let movInfo = [];\n    let movsRef = firebase.database().ref('movies');\n    movsRef.once('value').then(snapshot => {\n      let movies = snapshot.val();\n      for (let entry in movies) {\n        if (movsInGraph.includes(entry)) {\n          movInfo.push({\n            id:  entry,\n            name:  movies[entry].name,\n            src:  movies[entry].src,\n            actors: movies[entry].actors,\n          })\n          console.log(\"already push actors: \", movies[entry].actors);\n        }\n      }\n\n      let ctr = 0;\n      for(let i in movInfo) {\n        let movieObj = {\n          type: 'movie',\n          name: movInfo[i].name,\n          src: movInfo[i].src,\n          id: ctr,\n        }\n        ctr++;\n        data.nodes.push(movieObj);\n     \n     //    console.log(\"movie actors are :\", movInfo[i].actors);\n        let actors = movInfo[i].actors.split(', ');\n        for(let j in actors) {\n          let actObj = {\n            type: 'actor',\n            name: actors[j],\n            id: ctr,\n          }\n          ctr++;\n          if(!(encounteredActors.includes(actors[j]))) {\n            encounteredActors.push(actors[j]);\n            data.nodes.push(actObj);\n            let loc = data.nodes.indexOf(actObj);\n            actorPos.push(loc);\n          }\n          \n          let linkObj = {\n            source: movInfo[i].name,\n            target: actors[j],\n          }\n          data.links.push(linkObj);\n        }\n      }\n\n      const elem = document.getElementById('mysvg');\n      elem.appendChild(this.chart(data.nodes, data.links));\n    });\n  }\n\n  componentWillUnmount() {\n    data.nodes = [];\n    data.links = [];\n    encounteredActors = [];\n    actorPos = [];\n  }\n\n  render() {\n    return <div id='mysvg'>\n      </div>      \n  }\n}\nexport default Graph;"]},"metadata":{},"sourceType":"module"}