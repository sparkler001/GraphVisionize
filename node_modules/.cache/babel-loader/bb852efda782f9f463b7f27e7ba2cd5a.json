{"ast":null,"code":"var _jsxFileName = \"/Users/yanghaochen/Desktop/CS185/CS185_hw8/src/Components/Movie.js\";\nimport React, { Component } from 'react';\nimport Helper from './Movie_helper2';\nimport config from '../config.js'; // import './Movie.css';\n\nconst firebase = require('firebase');\n\nexport class Movie extends Component {\n  constructor(props) {\n    super();\n\n    this.myChangeHandler = event => {\n      let n = event.target.name;\n      let v = event.target.value;\n      this.setState({\n        [n]: v\n      });\n      let movie_choice = document.getElementById('list').value;\n\n      if (movie_choice === 'all') {\n        let ref = firebase.database().ref('movies');\n        ref.once('value').then(snapshot => {\n          let movies = snapshot.val();\n          let newData = [];\n\n          for (let entry in movies) {\n            newData.push({\n              id: entry,\n              name: movies[entry].name,\n              src: movies[entry].src,\n              director: movies[entry].director,\n              imdb: movies[entry].imdb,\n              plot: movies[entry].plot\n            });\n          }\n\n          this.setState({\n            lastMov: newData[newData.length - 1]\n          });\n\n          if (newData.length < 9) {\n            this.setState({\n              displayButton: 'none'\n            });\n          } else {\n            this.setState({\n              displayButton: 'block'\n            });\n          }\n        });\n        let first = ref.orderByKey().limitToFirst(9);\n        first.once('value').then(snapshot => {\n          let l_movie = snapshot.val();\n          let hit_eight = [];\n\n          for (let entry in l_movie) {\n            hit_eight.push({\n              id: entry,\n              name: l_movie[entry].name,\n              src: l_movie[entry].src,\n              director: l_movie[entry].director,\n              imdb: l_movie[entry].imdb,\n              plot: l_movie[entry].plot\n            });\n          }\n\n          this.setState({\n            currPoint: hit_eight[hit_eight.length - 1].id\n          });\n          hit_eight.pop();\n          this.setState({\n            movies: hit_eight\n          });\n        });\n      } else {\n        let movsInList = [];\n        let ref = firebase.database().ref('relations');\n        ref.once('value').then(snapshot => {\n          let rels = snapshot.val();\n\n          for (let entry in rels) {\n            if (rels[entry].list === movie_choice) {\n              movsInList.push(rels[entry].mov);\n            }\n          }\n\n          let movsRef = firebase.database().ref('movies');\n          movsRef.once('value').then(snapshot => {\n            let movies = snapshot.val();\n            let newData = [];\n\n            for (let entry in movies) {\n              if (movsInList.includes(entry)) {\n                newData.push({\n                  id: entry,\n                  name: movies[entry].name,\n                  src: movies[entry].src,\n                  director: movies[entry].director,\n                  imdb: movies[entry].imdb,\n                  plot: movies[entry].plot\n                });\n              }\n            }\n\n            if (newData.length < 9) {\n              this.setState({\n                displayButton: 'none'\n              });\n            } else {\n              this.setState({\n                displayButton: 'block'\n              });\n            }\n\n            this.setState({\n              movies: newData\n            });\n          });\n        });\n      }\n    };\n\n    this.state = {\n      movies: [],\n      lists: [],\n      currPoint: '',\n      lastMov: '',\n      movie_choice: '',\n      displayButton: 'none',\n      shouldUpdate: false\n    };\n  }\n\n  componentDidMount() {\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n\n    this.ref = firebase.database().ref('movies');\n    this.ref.on('value', snapshot => {\n      let movies = snapshot.val();\n      let newData = [];\n\n      for (let entry in movies) {\n        newData.push({\n          id: entry,\n          name: movies[entry].name,\n          src: movies[entry].src,\n          director: movies[entry].director,\n          imdb: movies[entry].imdb,\n          plot: movies[entry].plot\n        });\n      }\n\n      this.setState({\n        lastMov: newData[newData.length - 1]\n      });\n\n      if (newData.length < 9) {\n        this.setState({\n          displayButton: 'none'\n        });\n      } else {\n        this.setState({\n          displayButton: 'block'\n        });\n      }\n    });\n    let first = this.ref.orderByKey().limitToFirst(9);\n    first.on('value', snapshot => {\n      let movie = snapshot.val();\n      let hit_eight = [];\n\n      for (let entry in movie) {\n        hit_eight.push({\n          id: entry,\n          name: movie[entry].name,\n          src: movie[entry].src,\n          director: movie[entry].director,\n          imdb: movie[entry].imdb,\n          plot: movie[entry].plot\n        });\n      }\n\n      this.setState({\n        currPoint: hit_eight[hit_eight.length - 1].id\n      });\n      hit_eight.pop();\n      this.setState({\n        movies: hit_eight\n      });\n    });\n    this.listRef = firebase.database().ref('lists');\n    this.listRef.on('value', snapshot => {\n      let lists = snapshot.val();\n      let newData = [];\n\n      for (let entry in lists) {\n        newData.push(lists[entry].name);\n      }\n\n      this.setState({\n        lists: newData\n      });\n    });\n  }\n\n  componentWillUnmount() {\n    this.ref.off();\n    this.listRef.off();\n  }\n\n  searchMovies() {\n    let movie_choice = document.getElementById('search').value.toLowerCase();\n    let ref = firebase.database().ref('movies');\n    ref.once('value').then(snapshot => {\n      let movies = snapshot.val();\n      let newData = [];\n\n      for (let entry in movies) {\n        let title = movies[entry].name.toLowerCase();\n\n        if (title.includes(movie_choice)) {\n          newData.push({\n            id: entry,\n            name: movies[entry].name,\n            src: movies[entry].src,\n            director: movies[entry].director,\n            imdb: movies[entry].imdb,\n            plot: movies[entry].plot\n          });\n        }\n      }\n\n      if (newData.length < 9) {\n        this.setState({\n          displayButton: 'none'\n        });\n      } else {\n        this.setState({\n          displayButton: 'block'\n        });\n      }\n\n      this.setState({\n        movies: newData\n      });\n    });\n  }\n\n  getMoreMovies() {\n    let ref = firebase.database().ref('movies');\n    let next = ref.orderByKey().startAt(this.state.currPoint).limitToFirst(9);\n    next.on('value', snapshot => {\n      let l_movie = snapshot.val();\n      let hit_eight = [];\n\n      for (let entry in l_movie) {\n        hit_eight.push({\n          id: entry,\n          name: l_movie[entry].name,\n          src: l_movie[entry].src,\n          director: l_movie[entry].director,\n          imdb: l_movie[entry].imdb,\n          plot: l_movie[entry].plot\n        });\n      }\n\n      if (hit_eight[hit_eight.length - 1].id === this.state.lastMov.id && hit_eight.length <= 8) {\n        this.setState({\n          displayButton: 'none'\n        });\n      } else {\n        this.setState({\n          currPoint: hit_eight[hit_eight.length - 1].id\n        });\n        hit_eight.pop();\n      }\n\n      let m_count = this.state.movies;\n      m_count = m_count.concat(hit_eight);\n      this.setState({\n        movies: m_count\n      });\n    });\n  }\n\n  enlarge(image, title, director, rating, plot, idVal) {\n    document.body.style.overflow = 'hidden';\n    var lightbox = document.createElement('div');\n    lightbox.id = 'box';\n    lightbox.className = 'box_setting';\n    var box_wrap = document.createElement('img');\n    box_wrap.src = image;\n    box_wrap.id = 'box_wrap';\n    var box_appearance = document.createElement('div');\n    box_appearance.id = 'box_appearance';\n    box_appearance.className = 'appearance';\n    var box_info = document.createElement('div');\n    box_info.id = 'box_info';\n    box_info.innerHTML = '<span class=\\'title\\'>' + title + '</span><br/><span class=\\'director\\'> Directed by:  ' + director + '</span><br/> <p>' + plot + '</p>  <br/><br/>   <span class=\\'rating\\'>   &nbsp;&nbsp; &nbsp; IMDB Score: ' + rating + '  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <br/><br/>';\n    var addtolist = document.createElement('select');\n    addtolist.id = 'addtolist';\n    addtolist.style.marginTop = '10px';\n    let listRef = firebase.database().ref('lists');\n    let tempList = [];\n    listRef.once('value').then(snapshot => {\n      let lists = snapshot.val();\n\n      for (let entry in lists) {\n        tempList.push(lists[entry].name);\n      }\n\n      let relRef = firebase.database().ref('relations');\n      relRef.once('value').then(snapshot => {\n        let rels = snapshot.val();\n\n        for (let entry in rels) {\n          if (rels[entry].mov === idVal) {\n            let pos = tempList.indexOf(rels[entry].list);\n            tempList.splice(pos, 1);\n          }\n        }\n\n        var opt = document.createElement('option');\n        opt.value = '';\n        opt.innerHTML = 'List Options   <br/> <br/>';\n        opt.disabled = 'true';\n        opt.selected = 'true';\n        opt.hidden = 'true';\n        addtolist.appendChild(opt);\n\n        for (var i in tempList) {\n          opt = document.createElement('option');\n          opt.value = tempList[i];\n          opt.innerHTML = tempList[i];\n          addtolist.appendChild(opt);\n        }\n      });\n    });\n    var list_helper = document.createElement('div');\n    var list_button = document.createElement('button');\n    list_button.id = 'listbutton';\n    list_button.innerHTML = 'Confirm List';\n    list_helper.appendChild(addtolist);\n    list_helper.appendChild(list_button);\n\n    list_button.onclick = function () {\n      var choice = document.getElementById('addtolist').value;\n\n      if (choice.length === 0) {\n        alert('No list has been selected.');\n      } else {\n        let formObj = {\n          mov: idVal,\n          list: choice\n        };\n        firebase.database().ref('relations').push().set(formObj);\n        alert('Confirmed Add!');\n      }\n    };\n\n    var delete_func = document.createElement('button');\n    delete_func.id = 'delete_button';\n    delete_func.innerHTML = '<br/> Delete Current Movie <br/><br/>';\n\n    delete_func.onclick = function () {\n      if (window.confirm('You Really Want Deletion ?')) {\n        let ref = firebase.database().ref('movies');\n        ref.on('value', snapshot => {\n          let movies = snapshot.val();\n\n          for (let entry in movies) {\n            if (entry === idVal) {\n              firebase.database().ref('movies/' + entry).remove();\n            }\n          }\n        });\n        let refList = firebase.database().ref('relations');\n        refList.on('value', snapshot => {\n          let relations = snapshot.val();\n\n          for (let entry in relations) {\n            if (relations[entry].mov === idVal) {\n              firebase.database().ref('relations/' + entry).remove();\n            }\n          }\n        });\n        document.getElementById('box').removeChild(document.getElementById('box_appearance'));\n        document.body.removeChild(document.getElementById('box'));\n        document.body.style.overflow = 'auto';\n      }\n\n      window.confirm('Deletion Complete!');\n    };\n\n    document.body.appendChild(lightbox);\n    document.getElementById('box').appendChild(box_appearance);\n    document.getElementById('box_appearance').appendChild(box_wrap);\n    document.getElementById('box_appearance').appendChild(box_info);\n    document.getElementById('box_info').appendChild(list_helper);\n    document.getElementById('box_info').appendChild(delete_func);\n    document.getElementById('box').addEventListener('click', function (event) {\n      if (event.target.className === 'box_setting') {\n        document.getElementById('box').removeChild(document.getElementById('box_appearance'));\n        document.body.removeChild(document.getElementById('box'));\n        document.body.style.overflow = 'auto';\n      }\n    });\n  } // output\n\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"h6\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 370,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 370,\n        columnNumber: 15\n      }\n    })), \"Movie List:\", /*#__PURE__*/React.createElement(\"div\", {\n      className: \"Movie_bars\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 372,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"lists_bar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"select\", {\n      name: \"movie_choice\",\n      id: \"list\",\n      onChange: this.myChangeHandler,\n      style: {\n        fontSize: 19,\n        fontFamily: 'Comic Sans MS'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 375,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"option\", {\n      value: \"all\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 17\n      }\n    }, \"All Movie Lists\"), /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 21\n      }\n    })), this.state.lists.map(list => /*#__PURE__*/React.createElement(\"option\", {\n      value: list,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 21\n      }\n    }, list)))), /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 388,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 388,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"search_bar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 390,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      id: \"bar_search\",\n      placeholder: \"Which movie you want to see?\",\n      name: \"search\",\n      id: \"search\",\n      style: {\n        fontSize: 19,\n        fontFamily: 'Comic Sans MS'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      id: \"search_button\",\n      onClick: this.searchMovies.bind(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 15\n      }\n    }, \"Search\")))), /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"Movies_content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 403,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Helper, {\n      movieList: this.state.movies,\n      enlarge: this.enlarge,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"load_button_position\",\n      style: {\n        display: this.state.displayButton\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      id: \"load_button\",\n      onClick: this.getMoreMovies.bind(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 13\n      }\n    }, \"Load More\")));\n  }\n\n}\nexport default Movie;","map":{"version":3,"sources":["/Users/yanghaochen/Desktop/CS185/CS185_hw8/src/Components/Movie.js"],"names":["React","Component","Helper","config","firebase","require","Movie","constructor","props","myChangeHandler","event","n","target","name","v","value","setState","movie_choice","document","getElementById","ref","database","once","then","snapshot","movies","val","newData","entry","push","id","src","director","imdb","plot","lastMov","length","displayButton","first","orderByKey","limitToFirst","l_movie","hit_eight","currPoint","pop","movsInList","rels","list","mov","movsRef","includes","state","lists","shouldUpdate","componentDidMount","apps","initializeApp","on","movie","listRef","componentWillUnmount","off","searchMovies","toLowerCase","title","getMoreMovies","next","startAt","m_count","concat","enlarge","image","rating","idVal","body","style","overflow","lightbox","createElement","className","box_wrap","box_appearance","box_info","innerHTML","addtolist","marginTop","tempList","relRef","pos","indexOf","splice","opt","disabled","selected","hidden","appendChild","i","list_helper","list_button","onclick","choice","alert","formObj","set","delete_func","window","confirm","remove","refList","relations","removeChild","addEventListener","render","fontSize","fontFamily","map","bind","display"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Helper from './Movie_helper2';\nimport config from '../config.js';\n// import './Movie.css';\nconst firebase = require('firebase');\n\nexport class Movie extends Component {\n  constructor(props) {\n    super();\n    this.state = {\n      movies: [],\n      lists: [],\n      currPoint: '',\n      lastMov: '',\n      movie_choice: '',\n      displayButton: 'none',\n      shouldUpdate: false,\n    }\n  }\n\n\n  componentDidMount(){\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n    \n    this.ref = firebase.database().ref('movies');\n    this.ref.on('value', snapshot => {\n      let movies = snapshot.val();\n        let newData = [];\n        for (let entry in movies) {\n          newData.push({\n            id:  entry,\n            name:  movies[entry].name,\n            src:  movies[entry].src,\n            director:  movies[entry].director,\n            imdb:  movies[entry].imdb,\n            plot:  movies[entry].plot,\n          })\n        }\n        \n        this.setState({lastMov: newData[newData.length-1]});\n        if(newData.length < 9) {\n          this.setState({displayButton: 'none'});\n        } \n        else {\n          this.setState({displayButton: 'block'});\n        }\n    });\n\n    let first = this.ref.orderByKey().limitToFirst(9);\n    first.on('value', snapshot => {\n      let movie = snapshot.val();\n      let hit_eight = [];\n      for (let entry in movie) {\n        hit_eight.push({\n          id:  entry,\n          name:  movie[entry].name,\n          src:  movie[entry].src,\n          director:  movie[entry].director,\n          imdb:  movie[entry].imdb,\n          plot:  movie[entry].plot,\n        });\n      }\n\n      this.setState({currPoint: hit_eight[hit_eight.length-1].id});\n      hit_eight.pop();\n      this.setState({movies: hit_eight});\n    });\n\n    this.listRef = firebase.database().ref('lists');\n    this.listRef.on('value', snapshot => {\n      let lists = snapshot.val();\n        let newData = [];\n        for (let entry in lists) {\n          newData.push(\n            lists[entry].name\n          )\n        }\n        this.setState({lists: newData});\n    })\n  }\n\n\n  componentWillUnmount() {\n    this.ref.off();\n    this.listRef.off();\n  }\n\n\n  searchMovies() {\n    let movie_choice = document.getElementById('search').value.toLowerCase();\n    let ref = firebase.database().ref('movies');\n    ref.once('value').then(snapshot => {\n      let movies = snapshot.val();\n        let newData = [];\n        for (let entry in movies) {\n          let title = (movies[entry].name).toLowerCase();\n          if (title.includes(movie_choice)) {\n            newData.push({\n              id:  entry,\n              name:  movies[entry].name,\n              src:  movies[entry].src,\n              director:  movies[entry].director,\n              imdb:  movies[entry].imdb,\n              plot:  movies[entry].plot,\n            })\n          }\n        }\n        if(newData.length < 9) {\n          this.setState({displayButton: 'none'});\n        } \n        else {\n          this.setState({displayButton: 'block'});\n        }\n        this.setState({movies: newData});\n    })\n  }\n\n\n  getMoreMovies() {\n    let ref = firebase.database().ref('movies');\n    let next = ref.orderByKey().startAt(this.state.currPoint).limitToFirst(9);\n    next.on('value', snapshot => {\n      let l_movie = snapshot.val();\n      let hit_eight = [];\n      for (let entry in l_movie) {\n        hit_eight.push({\n          id:  entry,\n          name:  l_movie[entry].name,\n          src:  l_movie[entry].src,\n          director:  l_movie[entry].director,\n          imdb:  l_movie[entry].imdb,\n          plot:  l_movie[entry].plot,\n        });\n      }\n      if(hit_eight[hit_eight.length-1].id === this.state.lastMov.id && hit_eight.length <= 8) {\n        this.setState({displayButton: 'none'});\n      } \n      else {\n        this.setState({currPoint: hit_eight[hit_eight.length-1].id});\n        hit_eight.pop();\n      }\n      let m_count = this.state.movies;\n      m_count = m_count.concat(hit_eight);\n      this.setState({movies: m_count});\n    });\n  }\n\n\n  myChangeHandler = (event) => {\n    let n = event.target.name;\n    let v = event.target.value;\n    this.setState({[n]: v});   \n    \n    let movie_choice = document.getElementById('list').value;\n    if(movie_choice === 'all') {\n      let ref = firebase.database().ref('movies');\n      ref.once('value').then(snapshot => {\n        let movies = snapshot.val();\n          let newData = [];\n          for (let entry in movies) {\n            newData.push({\n              id:  entry,\n              name:  movies[entry].name,\n              src:  movies[entry].src,\n              director:  movies[entry].director,\n              imdb:  movies[entry].imdb,\n              plot:  movies[entry].plot,\n            })\n          }\n          this.setState({lastMov: newData[newData.length-1]});\n          if(newData.length < 9) {\n            this.setState({displayButton: 'none'});\n          } \n          else {\n            this.setState({displayButton: 'block'});\n          }\n      });\n\n      \n      let first = ref.orderByKey().limitToFirst(9);\n      first.once('value').then(snapshot => {\n        let l_movie = snapshot.val();\n        let hit_eight = [];\n        for (let entry in l_movie) {\n          hit_eight.push({\n            id:  entry,\n            name:  l_movie[entry].name,\n            src:  l_movie[entry].src,\n            director:  l_movie[entry].director,\n            imdb:  l_movie[entry].imdb,\n            plot:  l_movie[entry].plot,\n          });\n        }\n        this.setState({currPoint: hit_eight[hit_eight.length-1].id});\n        hit_eight.pop();\n        this.setState({movies: hit_eight});\n      });\n    } \n    \n    \n    else {\n      let movsInList = [];\n      let ref = firebase.database().ref('relations');\n      ref.once('value').then(snapshot => {\n        let rels = snapshot.val();\n        for (let entry in rels) {\n          if(rels[entry].list === movie_choice) {\n            movsInList.push(rels[entry].mov);\n          }\n        }\n        let movsRef = firebase.database().ref('movies');\n        movsRef.once('value').then(snapshot => {\n          let movies = snapshot.val();\n          let newData = [];\n          for (let entry in movies) {\n            if (movsInList.includes(entry)) {\n              newData.push({\n                id:  entry,\n                name:  movies[entry].name,\n                src:  movies[entry].src,\n                director:  movies[entry].director,\n                imdb:  movies[entry].imdb,\n                plot:  movies[entry].plot,\n              })\n            }\n          }\n          if(newData.length < 9) {\n            this.setState({displayButton: 'none'});\n          } else {\n            this.setState({displayButton: 'block'});\n          }\n          this.setState({movies: newData});\n        })\n      })\n    }\n  }\n\n\n  enlarge(image, title, director, rating, plot, idVal) {\n    document.body.style.overflow = 'hidden';\n  \n    var lightbox = document.createElement('div');\n    lightbox.id = 'box';\n    lightbox.className = 'box_setting';\n    var box_wrap = document.createElement('img');\n    box_wrap.src = image;\n    box_wrap.id = 'box_wrap';\n    var box_appearance = document.createElement('div');\n    box_appearance.id = 'box_appearance';\n    box_appearance.className = 'appearance'; \n    var box_info = document.createElement('div');\n    box_info.id = 'box_info';\n    box_info.innerHTML = '<span class=\\'title\\'>'+title+'</span><br/><span class=\\'director\\'> Directed by:  '+director+'</span><br/> <p>'+plot+'</p>  <br/><br/>   <span class=\\'rating\\'>   &nbsp;&nbsp; &nbsp; IMDB Score: '+rating+'  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <br/><br/>';\n\n    var addtolist = document.createElement('select');\n    addtolist.id = 'addtolist';\n    addtolist.style.marginTop = '10px';\n    let listRef = firebase.database().ref('lists');\n    let tempList = [];\n    listRef.once('value').then(snapshot => {\n    \n      let lists = snapshot.val();\n        for (let entry in lists) {\n          tempList.push(lists[entry].name);\n        }\n        let relRef = firebase.database().ref('relations');\n        relRef.once('value').then(snapshot => {\n          let rels = snapshot.val();\n            for (let entry in rels) {\n              if(rels[entry].mov === idVal) {\n                let pos = tempList.indexOf(rels[entry].list);\n                tempList.splice(pos, 1);\n              }\n            }\n            var opt = document.createElement('option');\n            opt.value = '';\n            opt.innerHTML = 'List Options   <br/> <br/>';\n            opt.disabled = 'true';\n            opt.selected = 'true';\n            opt.hidden = 'true';\n            addtolist.appendChild(opt);\n            for(var i in tempList) {\n              opt = document.createElement('option');\n              opt.value= tempList[i];\n              opt.innerHTML = tempList[i]; \n              addtolist.appendChild(opt);\n            }\n        });\n    });\n\n\n    var list_helper = document.createElement('div');\n    var list_button = document.createElement('button');\n    list_button.id = 'listbutton';\n    list_button.innerHTML = 'Confirm List';\n\n\n    list_helper.appendChild(addtolist);\n    list_helper.appendChild(list_button);\n\n    list_button.onclick = function () {\n      var choice = document.getElementById('addtolist').value;\n      if(choice.length === 0) {\n        alert('No list has been selected.');\n      } \n      \n      else {\n        let formObj = {\n          mov: idVal, \n          list: choice,\n        };\n\n      firebase.database().ref('relations').push().set(formObj);\n      alert('Confirmed Add!');\n      }\n    };\n\n    var delete_func = document.createElement('button');\n    delete_func.id = 'delete_button';\n    delete_func.innerHTML = '<br/> Delete Current Movie <br/><br/>';\n\n    delete_func.onclick = function () {\n    if(window.confirm('You Really Want Deletion ?')) {\n        let ref = firebase.database().ref('movies');\n        ref.on('value', snapshot => {\n          let movies = snapshot.val();\n            for (let entry in movies) {\n              if(entry === idVal) {firebase.database().ref('movies/'+entry).remove();}\n            }\n        })\n        let refList = firebase.database().ref('relations');\n        refList.on('value', snapshot => {\n          let relations = snapshot.val();\n            for (let entry in relations) {\n              if(relations[entry].mov === idVal) {firebase.database().ref('relations/'+entry).remove();}\n            }\n      })\n      document.getElementById('box').removeChild(document.getElementById('box_appearance'));\n      document.body.removeChild(document.getElementById('box'));\n      document.body.style.overflow = 'auto';\n      }\n      window.confirm('Deletion Complete!');\n    };\n\n    document.body.appendChild(lightbox);  \n    document.getElementById('box').appendChild(box_appearance);\n    document.getElementById('box_appearance').appendChild(box_wrap);\n    document.getElementById('box_appearance').appendChild(box_info);\n    document.getElementById('box_info').appendChild(list_helper);\n    document.getElementById('box_info').appendChild(delete_func);\n\n    document.getElementById('box').addEventListener('click', function(event) {\n      if(event.target.className === 'box_setting') {\n        document.getElementById('box').removeChild(document.getElementById('box_appearance'));\n        document.body.removeChild(document.getElementById('box'));\n        document.body.style.overflow = 'auto';\n      }\n    });\n  }\n\n\n  // output\n  render() {\n    return (\n      <div >\n          <div>\n\n          <h6><br/></h6>\n          Movie List:\n            <div className = 'Movie_bars'>\n\n            <div className='lists_bar'>\n              <select name='movie_choice' id='list' onChange={this.myChangeHandler}\n                style={{ fontSize: 19, fontFamily: 'Comic Sans MS'}}>\n                <option value='all'>All Movie Lists</option>\n                <h1><br/></h1>\n                \n                {\n                  this.state.lists.map((list) => (\n                    <option value={list}>{list}</option>\n                  ))\n                }\n              </select>\n            </div>\n\n            <h5><br/></h5>\n\n            <div className='search_bar'>\n              <input type='text' id='bar_search' placeholder='Which movie you want to see?' name='search' id='search' \n                style={{fontSize: 19, fontFamily: 'Comic Sans MS'}}/>\n\n              <button id='search_button' onClick={this.searchMovies.bind(this)} >Search</button>\n            </div>\n\n            </div>\n\n          </div>\n\n          <h5><br/></h5>\n\n          <div className='Movies_content'>\n            <Helper movieList={this.state.movies} enlarge={this.enlarge} />\n          </div>\n\n          <div className='load_button_position' style={{display: this.state.displayButton}}>\n            <button id='load_button' onClick={this.getMoreMovies.bind(this)}>Load More</button>\n          </div>\n\n      </div>\n    );\n  }\n}\nexport default Movie;"]},"metadata":{},"sourceType":"module"}